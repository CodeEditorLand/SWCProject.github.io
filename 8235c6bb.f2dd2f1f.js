(window.webpackJsonp=window.webpackJsonp||[]).push([[128],{202:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return p})),n.d(t,"default",(function(){return b}));var r=n(3),a=n(7),o=(n(0),n(347)),s=["components"],c={title:"Changelog: swc v1.2.50",author:"DongYoon Kang",authorURL:"http://github.com/kdy1",authorFBID:0x5af8dbecdbce},i={permalink:"/blog/2021/03/03/swc-1.2.50",source:"@site/blog/2021-03-03-swc-1.2.50.md",description:"Bugfixes",date:"2021-03-03T00:00:00.000Z",tags:[],title:"Changelog: swc v1.2.50",readingTime:2.705,truncated:!1,prevItem:{title:"Changelog: swc v1.2.51",permalink:"/blog/2021/03/28/swc-1.2.51"},nextItem:{title:"Changelog: swc v1.2.48",permalink:"/blog/2021/02/22/swc-1.2.48"}},p=[{value:"Bugfixes",id:"bugfixes",children:[{value:"TypeScript metadata for unions (#1421)",id:"typescript-metadata-for-unions-1421",children:[]},{value:"No duplicated <code>use strict</code> (#1423)",id:"no-duplicated-use-strict-1423",children:[]},{value:"<code>\r\n</code> in template literals (#1450)",id:"rn-in-template-literals-1450",children:[]},{value:"bundler: Many improvements (#1427)",id:"bundler-many-improvements-1427",children:[]},{value:"New option to prserve class name (#1279)",id:"new-option-to-prserve-class-name-1279",children:[]},{value:"Fix for switch statements in loops (#1415)",id:"fix-for-switch-statements-in-loops-1415",children:[]}]},{value:"New features",id:"new-features",children:[{value:"<code>.swcrc</code> option to enable sourcemps. (#1309)",id:"swcrc-option-to-enable-sourcemps-1309",children:[]},{value:"@babel/preset-modules (#1439)",id:"babelpreset-modules-1439",children:[]}]}],l={toc:p};function b(e){var t=e.components,n=Object(a.a)(e,s);return Object(o.b)("wrapper",Object(r.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"bugfixes"},"Bugfixes"),Object(o.b)("h3",{id:"typescript-metadata-for-unions-1421"},"TypeScript metadata for unions (",Object(o.b)("a",{parentName:"h3",href:"https://github.com/swc-project/swc/issues/1421"},"#1421"),")"),Object(o.b)("p",null,"Now ",Object(o.b)("a",{parentName:"p",href:"https://swc.rs"},"swc")," emits proper metadata for union of string literals, like in codes like"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-ts"},'import "reflect-metadata";\n\nconst COL_KEY = Symbol("col");\n\nconst column = () => {\n  return (object: any, key: string) => {\n    Reflect.defineMetadata(COL_KEY, "value", object, key);\n  };\n};\n\nclass User {\n  @column() currency!: "usd" | "eur" | "yen";\n}\n\nconsole.log(Reflect.getMetadata("design:type", User.prototype, "currency"));\n')),Object(o.b)("p",null,"Previously, the code printed ",Object(o.b)("inlineCode",{parentName:"p"},"undefined")," when compiled with ",Object(o.b)("a",{parentName:"p",href:"https://swc.rs"},"swc")," which is wrong.\nIt is now ",Object(o.b)("inlineCode",{parentName:"p"},"String"),"."),Object(o.b)("h3",{id:"no-duplicated-use-strict-1423"},"No duplicated ",Object(o.b)("inlineCode",{parentName:"h3"},"use strict")," (",Object(o.b)("a",{parentName:"h3",href:"https://github.com/swc-project/swc/issues/1423"},"#1423"),")"),Object(o.b)("p",null,"For code like"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-ts"},'"use strict";\n\nimport { arrayUtilities } from "necessary";\n\nconst { second } = arrayUtilities;\n\nconst elements = [1, 2, 3],\n  secondElement = second(elements);\n\nconsole.log(secondElement);\n')),Object(o.b)("p",null,Object(o.b)("a",{parentName:"p",href:"https://swc.rs"},"swc")," now emits"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-js"},'"use strict";\nvar _necessary = require("necessary");\nvar second = _necessary.arrayUtilities.second;\nvar elements = [1, 2, 3],\n  secondElement = second(elements);\nconsole.log(secondElement);\n')),Object(o.b)("p",null,"In previous versions, the ",Object(o.b)("inlineCode",{parentName:"p"},"'use strict'")," directive was emitted twice."),Object(o.b)("h3",{id:"rn-in-template-literals-1450"},Object(o.b)("inlineCode",{parentName:"h3"},"\\r\\n")," in template literals (",Object(o.b)("a",{parentName:"h3",href:"https://github.com/swc-project/swc/pull/1450"},"#1450"),")"),Object(o.b)("p",null,"Previously ",Object(o.b)("a",{parentName:"p",href:"https://swc.rs"},"swc")," miscompiled the code below."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-ts"},'import { MultipartReader } from "https://deno.land/std@0.88.0/mime/multipart.ts";\nimport { StringReader } from "https://deno.land/std@0.88.0/io/readers.ts";\n\n// carriage returns added for running on POSIX, not needed if on windows\nconst content = `--------------------------366796e1c748a2fb\\r\nContent-Disposition: form-data; name="payload"\\r\nContent-Type: text/plain\\r\n\\r\nCONTENT\\r\n--------------------------366796e1c748a2fb--`;\n\nconst boundary = "------------------------366796e1c748a2fb";\n\nconst stringReader = new StringReader(content);\n\nconst multipartReader = new MultipartReader(stringReader, boundary);\nconst formData = await multipartReader.readForm();\nfor (const entry of formData.entries()) {\n  console.log("entry", entry);\n}\nconsole.log("formdata", formData);\n')),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"\\r\\n")," in template literals was previously parsed as ",Object(o.b)("inlineCode",{parentName:"p"},"\\n"),", but it's now parsed as ",Object(o.b)("inlineCode",{parentName:"p"},"\\r\\n"),"."),Object(o.b)("h3",{id:"bundler-many-improvements-1427"},"bundler: Many improvements (",Object(o.b)("a",{parentName:"h3",href:"https://github.com/swc-project/swc/pull/1427"},"#1427"),")"),Object(o.b)("p",null,"The bundler of the ",Object(o.b)("a",{parentName:"p",href:"https://swc.rs"},"swc")," can now handle much more codes.\nVarious bugs are reported via ",Object(o.b)("a",{parentName:"p",href:"https://deno.land"},"deno")," and those are all fixed."),Object(o.b)("h3",{id:"new-option-to-prserve-class-name-1279"},"New option to prserve class name (",Object(o.b)("a",{parentName:"h3",href:"https://github.com/swc-project/swc/issues/1279"},"#1279"),")"),Object(o.b)("p",null,"To bypass restrictions of rust, ",Object(o.b)("a",{parentName:"p",href:"https://swc.rs"},"swc")," uses a trick named ",Object(o.b)("inlineCode",{parentName:"p"},"span hygiene"),".\nIt modifies identifier at the end to prevent conflict between identifiers.\nBut this operation can be problematic if the name of class matters."),Object(o.b)("p",null,"For example,"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-ts"},"class MyClass {\n  prop = 1;\n}\n\nfunction Decorator(): PropertyDecorator {\n  return () => undefined;\n}\nclass MyDecoratedClass {\n  @Decorator() prop = 1;\n}\n\nconsole.log(MyClass.name, MyDecoratedClass.name);\n")),Object(o.b)("p",null,"depends on the class name."),Object(o.b)("p",null,Object(o.b)("a",{parentName:"p",href:"https://swc.rs"},"swc")," now has an option to preserve class name.\nSee ",Object(o.b)("a",{parentName:"p",href:"https://swc.rs/docs/configuring-swc/#jsc"},"the documentation for .swcrc"),"."),Object(o.b)("h3",{id:"fix-for-switch-statements-in-loops-1415"},"Fix for switch statements in loops (",Object(o.b)("a",{parentName:"h3",href:"https://github.com/swc-project/swc/issues/1415"},"#1415"),")"),Object(o.b)("p",null,"When targeting ",Object(o.b)("inlineCode",{parentName:"p"},"es3")," or ",Object(o.b)("inlineCode",{parentName:"p"},"es5"),", ",Object(o.b)("a",{parentName:"p",href:"https://swc.rs"},"swc")," broke some codes with switch statements in for loops like"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-ts"},'export function test(items) {\n  const infoMap = new WeakMap();\n  for (let i = 0; i < items.length; i += 1) {\n    const item = items[i];\n    let info;\n    switch (item.type) {\n      case "branch1":\n        info = item.method1();\n        break;\n      case "branch2":\n        info = item.method2();\n        break;\n      case "branch3":\n        info = item.method3(\n          Object.fromEntries(\n            item.subItems.map((t) => [item.alias ?? t.name, getInfo(t)])\n          )\n        );\n        break;\n      default:\n        throw new Error("boom");\n    }\n    infoMap.set(item, info); // important\n  }\n\n  function getInfo(item) {\n    if (!infoMap.has(item)) {\n      throw new Error("no info yet");\n    }\n    return infoMap.get(item);\n  }\n}\n')),Object(o.b)("p",null,"It is now fixed."),Object(o.b)("h2",{id:"new-features"},"New features"),Object(o.b)("h3",{id:"swcrc-option-to-enable-sourcemps-1309"},Object(o.b)("inlineCode",{parentName:"h3"},".swcrc")," option to enable sourcemps. (",Object(o.b)("a",{parentName:"h3",href:"https://github.com/swc-project/swc/issues/1309"},"#1309"),")"),Object(o.b)("p",null,"Previously generating sourcemap required calling apis with proper option.\nBut now ",Object(o.b)("a",{parentName:"p",href:"https://swc.rs"},"swc")," has an option to enable sourcemap.\nSee ",Object(o.b)("a",{parentName:"p",href:"https://swc.rs/docs/configuring-swc/#sourcemaps"},"the documentation for .swcrc"),"."),Object(o.b)("h3",{id:"babelpreset-modules-1439"},"@babel/preset-modules (",Object(o.b)("a",{parentName:"h3",href:"https://github.com/swc-project/swc/pull/1439"},"#1439"),")"),Object(o.b)("p",null,"Thanks to ",Object(o.b)("a",{parentName:"p",href:"https://github.com/devongovett"},"@devongovett"),", ",Object(o.b)("a",{parentName:"p",href:"https://swc.rs"},"swc")," now has an option to enable bugfix transforms, just like ",Object(o.b)("inlineCode",{parentName:"p"},"preset-modules")," of babel."),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"bugfix/transform-async-arrows-in-class"),", ",Object(o.b)("inlineCode",{parentName:"p"},"bugfix/transform-edge-default-parameters")," and ",Object(o.b)("inlineCode",{parentName:"p"},"bugfix/transform-tagged-template-caching")," is added."))}b.isMDXComponent=!0},347:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return d}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=a.a.createContext({}),l=function(e){var t=a.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},b=function(e){var t=l(e.components);return a.a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},u=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),b=l(n),u=r,d=b["".concat(s,".").concat(u)]||b[u]||m[u]||o;return n?a.a.createElement(d,c(c({ref:t},p),{},{components:n})):a.a.createElement(d,c({ref:t},p))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=u;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:r,s[1]=c;for(var p=2;p<o;p++)s[p]=n[p];return a.a.createElement.apply(null,s)}return a.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);