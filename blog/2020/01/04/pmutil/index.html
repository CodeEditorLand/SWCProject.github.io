<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="swc Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="swc Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-81467907-3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-81467907-3",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="swc" href="/opensearch.xml"><title data-react-helmet="true">Introducing pmutil | swc</title><meta data-react-helmet="true" property="og:title" content="Introducing pmutil | swc"><meta data-react-helmet="true" name="description" content="swc uses proc macros extensively. I use a procedural macro if possible to reduce boilerplates and to avoid rewriting boilerplates when something is changed. Behind the scene, there&#x27;s a hero crate called pmutil. It provides useful stuffs for proc macros."><meta data-react-helmet="true" property="og:description" content="swc uses proc macros extensively. I use a procedural macro if possible to reduce boilerplates and to avoid rewriting boilerplates when something is changed. Behind the scene, there&#x27;s a hero crate called pmutil. It provides useful stuffs for proc macros."><meta data-react-helmet="true" property="og:image" content="https://swc.rs/img/swc.png"><meta data-react-helmet="true" name="twitter:image" content="https://swc.rs/img/swc.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Introducing pmutil | swc"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/styles.017e298e.css">
<link rel="preload" href="/styles.bc31a11e.js" as="script">
<link rel="preload" href="/runtime~main.4463f3fd.js" as="script">
<link rel="preload" href="/main.90f12d0a.js" as="script">
<link rel="preload" href="/1.a53d6d88.js" as="script">
<link rel="preload" href="/2.23236cd0.js" as="script">
<link rel="preload" href="/3.bb1d8e8a.js" as="script">
<link rel="preload" href="/ccc49370.4689c622.js" as="script">
<link rel="preload" href="/42c77dbb.e1eb92b3.js" as="script">
<link rel="preload" href="/0d6dc4dc.3fcfcad2.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><strong class="navbar__title">SWC</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs">Docs</a><a href="https://swc.rs/rustdoc/swc/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">SWC RustDocs</a><a class="navbar__item navbar__link" href="/help">Help</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a href="https://opencollective.com/swc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Donate</a><a href="https://github.com/swc-project/swc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><div class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></div></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><strong class="navbar__title">SWC</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs">Docs</a></li><li class="menu__list-item"><a href="https://swc.rs/rustdoc/swc/" target="_blank" rel="noopener noreferrer" class="menu__link">SWC RustDocs</a></li><li class="menu__list-item"><a class="menu__link" href="/help">Help</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://opencollective.com/swc" target="_blank" rel="noopener noreferrer" class="menu__link">Donate</a></li><li class="menu__list-item"><a href="https://github.com/swc-project/swc" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_SWld thin-scrollbar"><h3 class="sidebarItemTitle_Km2m">Recent posts</h3><ul class="sidebarItemList_3UpA"><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2021/01/31/swc-1.2.47">Changelog: swc v1.2.47</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2021/01/23/swc-1.2.46">Changelog: swc v1.2.46</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2021/01/14/swc-1.2.45">Changelog: swc v1.2.45</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2021/01/11/swc-1.2.44">Changelog: swc v1.2.44</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/12/30/swc-1.2.43">Changelog: swc v1.2.43</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/12/29/swc-1.2.42">Changelog: swc v1.2.42</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/12/22/swc-1.2.41">Changelog: swc v1.2.41</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/12/04/swc-1.2.40">Changelog: swc v1.2.40</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/11/21/swc-1.2.39">Changelog: swc v1.2.39</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/11/08/swc-1.2.38">Changelog: swc v1.2.38</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/10/29/swc-1.2.37">Changelog: swc v1.2.37</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/10/06/swc-1.2.36">Changelog: swc v1.2.36</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/10/04/swc-1.2.35">Changelog: swc v1.2.35</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/09/24/swc-1.2.33">ChangeLog: swc v1.2.33</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/09/24/swc-1.2.34">Hotfix: swc v1.2.34</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/09/22/swc-1.2.31">ChangeLog: swc v1.2.31</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/09/22/swc-1.2.32">ChangeLog: swc v1.2.32</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/09/18/swc-1.2.30">ChangeLog: swc v1.2.30</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/09/13/swc-1.2.27">ChangeLog: swc v1.2.27</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/09/11/swc-1.2.25">Changelog: swc v1.2.25</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/09/11/swc-1.2.26">Hotfix: swc v1.2.26</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/09/08/swc-1.2.23">Changelog: swc v1.2.23</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/08/31/swc-1.2.22">Changelog: swc v1.2.22</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/08/24/swc-1.2.21">Changelog: swc v1.2.21</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/08/15/swc-1.2.20">Changelog: swc v1.2.20</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/08/13/swc-1.2.19">Changelog: swc v1.2.19</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/08/11/swc-1.2.18">Changelog: swc v1.2.18</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/08/10/swc-1.2.16">Changelog: swc v1.2.16</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/08/10/swc-1.2.17">Changelog: swc v1.2.17</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/08/09/swc-1.2.15">Changelog: swc v1.2.15</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/08/08/swc-1.2.14">Changelog: swc v1.2.14</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/08/07/swc-1.2.13">Changelog: swc v1.2.13</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/08/06/swc-1.2.12">Changelog: swc v1.2.12</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/08/02/swc-1.2.11">swc v1.2.11: Fix for almost all typescript bugs</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/07/31/swc-1.2.10">Changelog: swc v1.2.10</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/07/26/swc-1.2.9">Changelog: swc v1.2.9</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/07/05/swc-1.2.8">Changelog: swc v1.2.8</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/07/01/swc-1.2.7">Changelog: swc v1.2.7</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/06/21/swc-1.2.6">Changelog: swc v1.2.6</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/06/19/swc-1.2.5">Changelog: swc v1.2.5</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/06/18/swc-1.2">v1.2: spack: Yet another asset bundler</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/06/13/swc-1.1.58">Changelog: swc v1.1.58</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/06/11/swc-1.1.57">Changelog: swc v1.1.57</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/06/10/swc-1.1.56">Changelog: swc v1.1.56</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/06/09/swc-1.1.55">Changelog: swc v1.1.55</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/06/06/swc-1.1.54">Changelog: swc v1.1.54</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/06/03/swc-1.1.53">Changelog: swc v1.1.53</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/06/02/swc-1.1.52">Changelog: swc v1.1.52</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/05/30/swc-1.1.51">Changelog: swc v1.1.51</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/05/28/swc-1.1.49">Changelog: swc v1.1.49</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/05/28/swc-1.1.50">Hotfix: swc v1.1.50</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/05/25/swc-1.1.48">Changelog: swc v1.1.48</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/05/22/swc-1.1.47">Changelog: swc v1.1.47</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/05/21/swc-1.1.46">Changelog: swc v1.1.46</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/05/19/swc-1.1.44">Changelog: swc v1.1.44</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/05/19/swc-1.1.45">Changelog: swc v1.1.45</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/05/16/swc-1.1.43">Changelog: swc v1.1.43</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/05/05/swc-1.1.41">Changelog: swc v1.1.41</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/05/05/swc-1.1.42">Changelog: swc v1.1.42</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/05/03/swc-1.1.40">Changelog: swc v1.1.40</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/04/10/swc-1.1.39">Changelog: swc v1.1.39</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/04/05/swc-1.1.38">Changelog: swc v1.1.38</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/03/28/swc-1.1.37">Changelog: swc v1.1.37</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/03/26/swc-1.1.36">Changelog: swc v1.1.36</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/03/16/roadmap-and-call-for-help">Call for help and roadmap</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/03/14/swc-1.1.35">Changelog: swc v1.1.35</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/03/10/swc-1.1.34">Changelog: swc v1.1.34</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/03/04/swc-1.1.32">Changelog: swc v1.1.32</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/03/04/swc-1.1.33">Changelog: swc v1.1.33</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/03/01/swc-1.1.31">Changelog: swc v1.1.31</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/02/29/swc-1.1.30">Changelog: swc v1.1.30</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/02/27/swc-1.1.29">Changelog: swc v1.1.29</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/02/22/swc-1.1.28">Changelog: swc v1.1.28</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/02/20/swc-1.1.27">Changelog: swc v1.1.27</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/02/19/swc-1.1.26">Changelog: swc v1.1.26</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/02/17/swc-1.1.25">Changelog: swc v1.1.25</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/02/16/why-is-swc-fast">Why is swc fast?</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/02/13/swc-1.1.21">Changelog: swc v1.1.21</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/02/13/swc-1.1.22">Changelog: swc v1.1.22</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/02/13/swc-1.1.23">Changelog: swc v1.1.23 - hotfix</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/02/13/swc-1.1.24">Changelog: swc v1.1.24</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/02/07/swc-1.1.19">Changelog: swc v1.1.19</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/02/07/swc-1.1.20">Changelog: swc v1.1.20</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/01/30/swc-1.1.17">Changelog: swc v1.1.17</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/01/26/swc-1.1.16">Changelog: swc v1.1.16</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/01/24/swc-1.1.15">Changelog: swc v1.1.15</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/01/23/swc-1.1.14">Changelog: swc v1.1.14</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/01/17/swc-1.1.13">Changelog: swc v1.1.13</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/01/08/swc-1.1.12">Changelog: swc v1.1.12</a></li><li class="sidebarItem_2T0D"><a aria-current="page" class="sidebarItemLink_v5H9 sidebarItemLinkActive_1anX" href="/blog/2020/01/04/pmutil">Introducing pmutil</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2020/01/02/swc-1.1.11">Changelog: swc v1.1.11</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2019/12/29/swc-1.1.10">Changelog: swc v1.1.10: preset-env</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2019/12/25/swc-1.1.9">Changelog: swc v1.1.9</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2019/12/24/swc-1.1.8">Changelog: swc v1.1.8</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2019/12/21/swc-1.1.7">Changelog: swc v1.1.7</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2019/12/14/swc-1.1.6">Changelog: swc v1.1.6</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2019/12/11/swc-1.1.5">Changelog: swc v1.1.5</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2019/12/09/swc-1.1.4">Changelog: swc v1.1.4</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2019/12/04/swc-1.1.3">Changelog: swc v1.1.3</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2019/12/02/swc-1.1.2">Changelog: swc v1.1.2</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2019/12/01/swc-1.1.1">Changelog: swc v1.1.1</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2019/11/30/announcing-swc-1.1.0">Announcing swc v1.1.0</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog/2019/02/08/Introducing-swc-1.0">Introducing swc 1.0</a></li></ul></div></div><main class="col col--8"><article><header><h1 class="margin-bottom--sm blogPostTitle_3-lP">Introducing pmutil</h1><div class="margin-vert--md"><time datetime="2020-01-04T00:00:00.000Z" class="blogPostDate_Ta7i">January 4, 2020  Â· 10 min read</time></div><div class="avatar margin-vert--md"><div class="avatar__intro"><h4 class="avatar__name"><a href="http://github.com/kdy1" target="_blank" rel="noreferrer noopener">DongYoon Kang</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p><code>swc</code> uses proc macros extensively. I use a procedural macro if possible to reduce boilerplates and to avoid rewriting boilerplates when something is changed. Behind the scene, there&#x27;s a hero crate called <a href="https://github.com/kdy1/rust-pmutil" target="_blank" rel="noopener noreferrer">pmutil</a>. It provides useful stuffs for proc macros.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="features"></a>Features<a class="hash-link" href="#features" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="smart_quote"></a>smart_quote!<a class="hash-link" href="#smart_quote" title="Direct link to heading">#</a></h3><ul><li><a href="https://docs.rs/pmutil/0.5.2/pmutil/macro.smart_quote.html" target="_blank" rel="noopener noreferrer">doc</a></li></ul><p>It&#x27;s a rustfmt-friendly quasi quotter. It exploits the fact that <code>rustfmt</code> can format function-call-like macros.</p><p>It takes two arguments. The first argument is to list variables, and should be wrapped with <code>Vars { }</code>. You can think this as constructing a struct named <code>Vars</code>. It&#x27;s really the same, as shorthand notation is supported. It means, you can pass</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// type is not required in real code</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let i: Ident = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // ..</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let v = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // ..</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">smart_quote!(Vars {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    i,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    TypeName: &amp;v,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}, {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // ignore second argument at now</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Currently, <code>Vars{}</code> is required even if no variable is passed in. This restriction may be removed in the future.</p><p>The second argument is a template, wrapped with a group (<code>()</code>, <code>[]</code>, <code>{}</code>). In most cases, wrapping with <code>{</code> and <code>}</code> is best.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">smart_quote!(Vars {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    i,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    mtd_name: &amp;method,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    TypeName: &amp;input.ident,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}, {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    impl TypeName {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        pub const fn mtd_name(&amp;self) -&gt; usize{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            i</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>where the method is ident named <code>len</code>, i is an arbitrary value (we use <code>10</code> at here) and TypeName is the name of <code>DeriveInput</code> (we use <code>Enum</code> at here), expands to</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl Enum {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub const fn len(&amp;self) -&gt; usize {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        10</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>As rustfmt is happy with</p><ul><li>function-call-like macro invokation</li><li>a block containing multiple items</li></ul><p>you can do something like without breaking rustfmt.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">smart_quote!(Vars {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    is_body,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    mtd_name: &amp;method,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    TypeName: &amp;input.ident,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}, {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    impl TypeName {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        pub const fn mtd_name(&amp;self) -&gt; usize {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            i</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    impl TypeName {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        pub fn is(&amp;self) -&gt; bool {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            is_body</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="naming-convention"></a>Naming convention<a class="hash-link" href="#naming-convention" title="Direct link to heading">#</a></h3><p>I recommend to follow the naming convention of template argument. It means, identifier of a type should be passed in PascalCase although it is passed as a field initialization.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="quoteparse-and-error-reporting"></a>Quote.parse() and error reporting<a class="hash-link" href="#quoteparse-and-error-reporting" title="Direct link to heading">#</a></h3><ul><li><a href="https://docs.rs/pmutil/0.5.2/pmutil/struct.Quote.html#method.parse" target="_blank" rel="noopener noreferrer">doc</a></li></ul><p>You might think quasi quoting is enough and parsing quoted tokens to ast type is just waisting compile time.
It&#x27;s true if your project is small. But debugging proc macro is hard. I made 10+ proc macros and you should trust me. It&#x27;s really hard.</p><p>Let&#x27;s start with a simple wrong code.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">use syn::Expr;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let expr: Expr = Quote::new(def_site::&lt;Span&gt;())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .quote_with(smart_quote!(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Vars {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            impl Type {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .parse();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>As you generated a wrong token (impl block is not an expression), <code>Quote.parse()</code> will panic, reports the line of <code>smart_quote!</code> invocations and tell you to rerun after setting an environment variable named <code>DBG_DUMP</code> to 1. When you run with it, <code>Quote.parse()</code> will print the tokens you quoted.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">error: custom attribute panicked</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> --&gt; ecmascript/codegen/src/decl.rs:7:5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">7 |     #[emitter]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  |     ^^^^^^^^^^</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  = help: message: Quote::parse() failed.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          Note: quasi quotting was invoked from:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 ecmascript/codegen/macros/src/lib.rs:54:25</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          Error from syn: expected expression</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &gt;&gt;&gt;&gt;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  To get code failed to parse,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           please set environment variable `DBG_DUMP` and run in again</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &lt;&lt;&lt;&lt;&lt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">error: aborting due to previous error</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">error: could not compile `swc_ecma_codegen`.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Yes, I broke code to show the message. With <code>DBG_DUMP=1</code>,</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">error: custom attribute panicked</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> --&gt; ecmascript/codegen/src/decl.rs:7:5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">7 |     #[emitter]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  |     ^^^^^^^^^^</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  = help: message: Quote::parse() failed.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          Note: quasi quotting was invoked from:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 ecmascript/codegen/macros/src/lib.rs:54:25</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          Error from syn: expected expression</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &gt;&gt;&gt;&gt;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  impl Type { }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &lt;&lt;&lt;&lt;&lt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">error: aborting due to previous error</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">error: could not compile `swc_ecma_codegen`.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>You can see the code, which is clearly not an expression, and fix it.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="totokensext"></a>ToTokensExt<a class="hash-link" href="#totokensext" title="Direct link to heading">#</a></h3><ul><li><a href="https://docs.rs/pmutil/0.5.2/pmutil/trait.ToTokensExt.html" target="_blank" rel="noopener noreferrer">doc</a></li></ul><p>If you have an experience of writing a proc macro, you may know <code>proc_macro::TokenStream</code> and <code>proc_macro2::TokenStream</code> interop badly, as name is equal to each other. <code>ToTokensExt</code> helps you.</p><p>It provides a <code>.dump()</code> method, which returns <code>proc_macro2::TokenStream</code> without bringing the name into scope.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// more imports</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use proc_macro::TokenStream;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[proc_macro_derive(Is, attributes(is))]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn is(input: TokenStream) -&gt; TokenStream {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let input: DeriveInput = syn::parse(input).expect(&quot;failed to parse derive input&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let generics: Generics = input.generics.clone();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let items = match input.data {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Data::Enum(e) =&gt; expand(e),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        _ =&gt; panic!(&quot;`Is` can be applied only on enums&quot;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ItemImpl {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        attrs: vec![],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        defaultness: None,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        unsafety: None,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        impl_token: Default::default(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        generics: Default::default(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        trait_: None,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        self_ty: Box::new(Type::Path(TypePath {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            qself: None,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            path: Path::from(input.ident),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        })),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        brace_token: Default::default(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        items,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .with_generics(generics)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .dump()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .into()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The method is also useful for debugging as <code>proc_macro2::TokenStream</code> implements Display while ast types from syn do not implement it.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="macros-built-with-pmutil"></a>Macros built with pmutil<a class="hash-link" href="#macros-built-with-pmutil" title="Direct link to heading">#</a></h2><p>Lots of macros are built over <a href="https://github.com/kdy1/rust-pmutil" target="_blank" rel="noopener noreferrer">pmutil</a>.</p><p>If you want a macro below to be a standalone crate, please ping me on slack (<a href="https://swc-slackin.herokuapp.com/" target="_blank" rel="noopener noreferrer">slackin for swc</a>) or <a href="https://github.com/swc-project/swc/issues/new" target="_blank" rel="noopener noreferrer">file an issue at github</a>.</p><p>(This is one of the reasons why I&#x27;m writing this section)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fromvariant-swc"></a>FromVariant (swc)<a class="hash-link" href="#fromvariant-swc" title="Direct link to heading">#</a></h3><ul><li>doc: <a href="https://swc-project.github.io/rustdoc/ast_node/derive.FromVariant.html" target="_blank" rel="noopener noreferrer"><code>#[derive(FromVariant)]</code></a></li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Debug, Clone, FromVariant)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub enum Expr {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Lit(Lit),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Ident(Ident),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Generated impls:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl From&lt;Lit&gt; for Expr {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl From&lt;Ident&gt; for Expr {}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>It uses pmutil like</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// In real code, ItemImpl is inferred</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let from_impl: ItemImpl = Quote::new_call_site()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .quote_with(smart_quote!(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Vars {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            VariantType: field.ty,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Variant: variant_name,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Type: &amp;ident,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            impl From&lt;VariantType&gt; for Type {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                fn from(v: VariantType) -&gt; Self {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    Type::Variant(v)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .parse();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>where <code>VariantType</code> is replaced with the type of the only field of the variant, <code>Variant</code> is replaced with the name of the variant, and Type is replaced with the name of the enum itself.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ast_node-swc"></a>ast_node (swc)<a class="hash-link" href="#ast_node-swc" title="Direct link to heading">#</a></h3><ul><li>doc: <a href="https://swc-project.github.io/rustdoc/ast_node/attr.ast_node.html" target="_blank" rel="noopener noreferrer"><code>#[ast_node]</code></a></li></ul><p>Alias for <code>#[derive(Spanned, Fold, Clone, Debug, PartialEq)]</code> for a struct and <code>#[derive(Spanned, Fold, Clone, Debug, PartialEq, FromVariant)]</code> for an enum.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fold-visit-swc"></a>Fold, Visit (swc)<a class="hash-link" href="#fold-visit-swc" title="Direct link to heading">#</a></h3><ul><li>doc: <a href="https://swc-project.github.io/rustdoc/ast_node/derive.Fold.html" target="_blank" rel="noopener noreferrer"><code>#[derive(Fold)]</code></a></li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Fold)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct Ident {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub span: Span,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub sym: String,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Fold)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct Lit {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub span: Span,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub value: String,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Fold)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub enum Expr {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Ident(ident),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Lit(Str)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Generated impls:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl ::swc_common::FoldWith for Ident {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // fn fold_children()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl ::swc_common::VisitWith for Ident {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // fn visit_children()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl ::swc_common::FoldWith for Lit {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // fn fold_children()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl ::swc_common::VisitWith for Lit {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // fn visit_children()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl ::swc_common::FoldWith for Expr {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // fn fold_children()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl ::swc_common::VisitWith for Expr {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // fn visit_children()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>With specialization, which requires nightly, it becomes an automagical weapon.</p><p>You can collect all identifiers in ast node with 20 lines of code however it is stored (unless you are using <code>#[fold(ignore)]</code>).</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">struct IdentCollector {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ids: Vec&lt;Ident&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl Visit&lt;Ident&gt; for IdentCollector {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fn visit(&amp;mut self, i: &amp;Ident) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        self.ids.push(i.clone());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn find_ids&lt;T: VisitWith&lt;IdentCollector&gt;&gt;(node: &amp;T) -&gt; Vec&lt;Ident&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let mut v = IdentCollector { ids: vec![] };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    node.visit_with(&amp;mut v);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    v.ids</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">assert_eq!(find_ids(box vec![Expr::Ident(i1), Expr::Lit(lit), Expr::Ident(i2)]) , vec![i1, i2]);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="spanned-swc"></a>Spanned (swc)<a class="hash-link" href="#spanned-swc" title="Direct link to heading">#</a></h3><ul><li>doc: <a href="https://swc-project.github.io/rustdoc/ast_node/derive.Spanned.html" target="_blank" rel="noopener noreferrer"><code>#[derive(Spanned)]</code></a></li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Spanned)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct Ident {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub span: Span,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub symbol: String,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Spanned)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct Lit {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub span: Span,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub value: String,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Spanned)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub enum Expr {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Lit(Lit),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Ident(Ident)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Generated impls:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl ::swc_common::Spannned for Ident {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl ::swc_common::Spannned for Lit {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl ::swc_common::Spannned for Expr {}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="enum_kind-swc"></a>enum_kind (swc)<a class="hash-link" href="#enum_kind-swc" title="Direct link to heading">#</a></h3><ul><li>doc: <a href="https://swc-project.github.io/rustdoc/enum_kind/derive.Kind.html" target="_blank" rel="noopener noreferrer"><code>#[derive(Kind)]</code></a></li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[macro_use]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">extern crate enum_kind;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/// You can split attributes if you want.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Kind)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[kind(functions(is_a = &quot;bool&quot;, is_b = &quot;bool&quot;))]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[kind(functions(is_a_or_b = &quot;bool&quot;, num = &quot;u8&quot;))]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub enum E {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[kind(is_a, is_a_or_b, num = &quot;1&quot;)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    A,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// You can split attributes if you want.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[kind(is_b)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[kind(is_a_or_b)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[kind(num = &quot;2&quot;)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    B(u8),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Default value of bool is false if not specified and true if specified.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ///</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Both struct like variant and tuple like variant are supported.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[kind(num = &quot;3&quot;)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    C {},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">assert!(E::A.is_a() &amp;&amp; E::A.is_a_or_b() &amp;&amp; !E::A.is_b());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">assert_eq!(E::A.num(), 1);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">assert!(!E::B(0).is_a() &amp;&amp; E::B(0).is_a_or_b() &amp;&amp; E::B(0).is_b());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">assert_eq!(E::B(0).num(), 2);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">assert!(!E::C {}.is_a() &amp;&amp; !E::C {}.is_a_or_b() &amp;&amp; !E::C {}.is_b());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">assert_eq!(E::C {}.num(), 3);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="string_enum-swc"></a>string_enum (swc)<a class="hash-link" href="#string_enum-swc" title="Direct link to heading">#</a></h3><ul><li>doc: <a href="https://swc-project.github.io/rustdoc/string_enum/derive.StringEnum.html" target="_blank" rel="noopener noreferrer">#[derive(StringEnum)]</a></li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(StringEnum)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub enum Tokens {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// `a`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    A,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// `bar`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    B,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Generated:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">//</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// pub fn as_str(&amp;self) -&gt; &amp;&#x27;static str</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// impl serde::Serilaize</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// impl serde::Deserilaize</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// impl FromStr</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// impl Debug</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// impl Display</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">assert_eq!(Tokens::A.as_str(), &quot;a&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">assert_eq!(Tokens::B.as_str(), &quot;bar&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">assert_eq!(Tokens::A.to_string(), &quot;a&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">assert_eq!(format!(&quot;{:?}&quot;, Tokens::A), format!(&quot;{:?}&quot;, &quot;a&quot;));</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="swc_ecma_parser_macros-swc"></a>swc_ecma_parser_macros (swc)<a class="hash-link" href="#swc_ecma_parser_macros-swc" title="Direct link to heading">#</a></h3><ul><li>doc: <a href="https://swc-project.github.io/rustdoc/swc_ecma_parser_macros/attr.parser.html" target="_blank" rel="noopener noreferrer"><code>#[parser]</code></a></li></ul><p>I&#x27;ll show you the code and then tell how it works.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[parser]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl&lt;&#x27;a, I: Tokens&gt; Parser&lt;&#x27;a, I&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fn parse_yield_expr(&amp;mut self) -&gt; PResult&lt;&#x27;a, Box&lt;Expr&gt;&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        let start = cur_pos!();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        assert_and_bump!(&quot;yield&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        debug_assert!(self.ctx().in_generator);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // Spec says</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // YieldExpression cannot be used within the FormalParameters of a generator</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // function because any expressions that are part of FormalParameters are</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // evaluated before the resulting generator object is in a resumable state.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if self.ctx().in_parameters {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            syntax_error!(self.input.prev_span(), SyntaxError::YieldParamInGen)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if is!(&#x27;;&#x27;) || (!is!(&#x27;*&#x27;) &amp;&amp; !cur!(false).map(Token::starts_expr).unwrap_or(true)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Ok(Box::new(Expr::Yield(YieldExpr {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                span: span!(start),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                arg: None,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                delegate: false,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            })))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        } else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            let has_star = eat!(&#x27;*&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            let arg = self.parse_assignment_expr()?;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Ok(Box::new(Expr::Yield(YieldExpr {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                span: span!(start),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                arg: Some(arg),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                delegate: has_star,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            })))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Did you get it? As <code>Input</code> is stored in <code>Parser</code>, you should pass an instance of <code>Parser</code> into macro, so code to consume a token should be</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">expect!(self, &quot;yield&quot;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>But <code>#[parser]</code> injects self to the code automatically. It knows the list of macros that accept <code>Parser</code> as a first argument and inject self into the macro call.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="swc_ecma_codegen_macros-swc"></a>swc_ecma_codegen_macros (swc)<a class="hash-link" href="#swc_ecma_codegen_macros-swc" title="Direct link to heading">#</a></h3><ul><li>doc: <a href="https://swc-project.github.io/rustdoc/swc_ecma_codegen_macros/attr.emitter.html" target="_blank" rel="noopener noreferrer"><code>#[emitter]</code></a></li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl Emitter {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #[emitter]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn emit_module(&amp;mut self, m: &amp;Module) -&gt; Result {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // ..</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>becomes</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl Emitter {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn emit_module(&amp;mut self, m: &amp;Module) -&gt; Result {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // ..</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl Node for Module {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fn emit_with(&amp;self, emitter: &amp;mut Emitter) -&gt; Result {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        emitter.emit_module(self)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Thus <code>emit!</code> works for any emittable types. <code>emit!</code> is defined as</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">macro_rules! emit {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ($emitter:expr, $e:expr) =&gt; {{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        crate::Node::emit_with(&amp;$e, $emitter)?;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>As the macro creates an impl block from a method, it reduced the amount of code drastically. (Writing impl Node for T every time is cumbersome.)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="is-macro"></a>is-macro<a class="hash-link" href="#is-macro" title="Direct link to heading">#</a></h3><ul><li>Repository: <a href="https://github.com/kdy1/is-macro" target="_blank" rel="noopener noreferrer">https://github.com/kdy1/is-macro</a></li></ul><p><code>is-macro</code> is a proc macro to generate methods for enum to allow using it like <code>Option</code> / <code>Result</code>.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">use is_macro::Is;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Debug, Is)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub enum Enum&lt;T&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    A,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    B(T),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    C(Option&lt;T&gt;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Generated methods:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">//</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// is_a(&amp;self), is_b(&amp;self), is_c(&amp;self)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// b(self) -&gt; Option&lt;T&gt;, c(self) -&gt; Option&lt;Option&lt;T&gt;&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// expect_b(self) -&gt; T, expect_c(self) -&gt; Option&lt;T&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">//</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Rust&#x27;s type inference cannot handle this.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">assert!(Enum::&lt;()&gt;::A.is_a());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">assert_eq!(Enum::B(String::from(&quot;foo&quot;)).b(), Some(String::from(&quot;foo&quot;)));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">assert_eq!(Enum::B(String::from(&quot;foo&quot;)).expect_b(), String::from(&quot;foo&quot;));</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="st-map"></a>st-map<a class="hash-link" href="#st-map" title="Direct link to heading">#</a></h3><ul><li>Repository: <a href="https://github.com/kdy1/rust-static-map" target="_blank" rel="noopener noreferrer">https://github.com/kdy1/rust-static-map</a></li></ul><p>This macro adds <code>.iter()</code>, <code>.iter_mut()</code>, <code>.into_iter()</code>, <code>.map(|k, v| {})</code>, <code>.map_values(|v| {})</code> to a map-like structs.
Map-like means that all fields have the same type.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-rust codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Debug, PartialEq, Default, StaticMap)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">struct BrowserData&lt;T: Default&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    chrome: T,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    safari: T,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    android: T,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> // Example of using generated methods.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // .iter(), .iter_mut(), .into_iter()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let mut data = BrowserData {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        chrome: true,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        safari: false,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        android: true,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    assert_eq!(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data.iter().collect::&lt;Vec&lt;_&gt;&gt;(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        vec![(&quot;chrome&quot;, &amp;true), (&quot;safari&quot;, &amp;false), (&quot;android&quot;, &amp;true),]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    assert_eq!(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data.iter_mut().collect::&lt;Vec&lt;_&gt;&gt;(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        vec![</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            (&quot;chrome&quot;, &amp;mut true),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            (&quot;safari&quot;, &amp;mut false),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            (&quot;android&quot;, &amp;mut true),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    assert_eq!(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data.into_iter().collect::&lt;Vec&lt;_&gt;&gt;(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        vec![(&quot;chrome&quot;, true), (&quot;safari&quot;, false), (&quot;android&quot;, true),]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // .map(), .map_values()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let data = BrowserData {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        chrome: 20000,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        safari: 10000,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ..Default::default()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    assert_eq!(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        data.map_value(|v| v &gt; 15000),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        BrowserData {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            chrome: true,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            safari: false,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            android: false,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></section></article><div></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2020/01/08/swc-1.1.12"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Changelog: swc v1.1.12</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2020/01/02/swc-1.1.11"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Changelog: swc v1.1.11 Â»</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#features" class="table-of-contents__link">Features</a><ul><li><a href="#smart_quote" class="table-of-contents__link">smart_quote!</a></li><li><a href="#naming-convention" class="table-of-contents__link">Naming convention</a></li><li><a href="#quoteparse-and-error-reporting" class="table-of-contents__link">Quote.parse() and error reporting</a></li><li><a href="#totokensext" class="table-of-contents__link">ToTokensExt</a></li></ul></li><li><a href="#macros-built-with-pmutil" class="table-of-contents__link">Macros built with pmutil</a><ul><li><a href="#fromvariant-swc" class="table-of-contents__link">FromVariant (swc)</a></li><li><a href="#ast_node-swc" class="table-of-contents__link">ast_node (swc)</a></li><li><a href="#fold-visit-swc" class="table-of-contents__link">Fold, Visit (swc)</a></li><li><a href="#spanned-swc" class="table-of-contents__link">Spanned (swc)</a></li><li><a href="#enum_kind-swc" class="table-of-contents__link">enum_kind (swc)</a></li><li><a href="#string_enum-swc" class="table-of-contents__link">string_enum (swc)</a></li><li><a href="#swc_ecma_parser_macros-swc" class="table-of-contents__link">swc_ecma_parser_macros (swc)</a></li><li><a href="#swc_ecma_codegen_macros-swc" class="table-of-contents__link">swc_ecma_codegen_macros (swc)</a></li><li><a href="#is-macro" class="table-of-contents__link">is-macro</a></li><li><a href="#st-map" class="table-of-contents__link">st-map</a></li></ul></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img class="footer__logo" src="https://raw.githubusercontent.com/swc-project/logo/master/swc.png"></div><div class="footer__copyright">Copyright Â© 2020 The swc project developers</div></div></div></footer></div>
<script src="/styles.bc31a11e.js"></script>
<script src="/runtime~main.4463f3fd.js"></script>
<script src="/main.90f12d0a.js"></script>
<script src="/1.a53d6d88.js"></script>
<script src="/2.23236cd0.js"></script>
<script src="/3.bb1d8e8a.js"></script>
<script src="/ccc49370.4689c622.js"></script>
<script src="/42c77dbb.e1eb92b3.js"></script>
<script src="/0d6dc4dc.3fcfcad2.js"></script>
</body>
</html>